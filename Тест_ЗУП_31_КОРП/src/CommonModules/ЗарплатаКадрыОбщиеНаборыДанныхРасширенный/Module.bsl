
#Область СлужебныеПроцедурыИФункции

Функция ПолучитьТекстОбщегоЗапроса(ИсточникДанных) Экспорт
	
	ТекстЗапроса = ЗарплатаКадрыОбщиеНаборыДанныхБазовый.ПолучитьТекстОбщегоЗапроса(ИсточникДанных);
	
	Если ВРег(ИсточникДанных) = ВРег("НачисленияУдержания") Тогда
		ДополнитьТекстЗапросаНачисленияУдержанияЗначениямиПоказателей(ТекстЗапроса);
	ИначеЕсли ВРег(ИсточникДанных) = ВРег("НачисленияУдержанияСтатистикаПерсонала") Тогда
		
		ТекстЗапроса = ЗарплатаКадрыОбщиеНаборыДанныхБазовый.ПолучитьТекстОбщегоЗапроса("НачисленияУдержания");
		ДополнитьТекстЗапросаНачисленияУдержанияЗначениямиПоказателей(ТекстЗапроса);
		
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ПОМЕСТИТЬ ОбщиеЗапросы_НачисленияУдержания", "ПОМЕСТИТЬ ОбщиеЗапросы_НачисленияУдержанияСтатистикаПерсонала");
		
		Если ВРег(ИсточникДанных) = ВРег("НачисленияУдержанияСтатистикаПерсонала") Тогда
			
			// Расширение набора данных кадровыми данными ВидДоговора
			ДополнительныеПоляКадровыхДанныхСотрудников = ЗарплатаКадрыОбщиеНаборыДанных.ПустаяТаблицаДополнительныхПолейПредставлений();
			
			СтрокаДополнительногоПоля = ДополнительныеПоляКадровыхДанныхСотрудников.Добавить();
			СтрокаДополнительногоПоля.ИмяПоля = "ВидДоговора";
			СтрокаДополнительногоПоля.ПустоеЗначениеНаЯзыкеЗапросов = "ЗНАЧЕНИЕ(Перечисление.ВидыДоговоровССотрудниками.ПустаяСсылка)";
			
			ЗарплатаКадрыОбщиеНаборыДанных.ВывестиДополнительныеПоляПредставленийВТекстЗапроса(ТекстЗапроса, ДополнительныеПоляКадровыхДанныхСотрудников, "Представления_КадровыеДанныеСотрудниковАнализНачисленийИУдержаний");
			
		КонецЕсли;
		
	ИначеЕсли ВРег(ИсточникДанных) = ВРег("НачисленияУдержанияАвансом") Тогда
		
		ТекстЗапроса = 
			"ВЫБРАТЬ
			|	ДАТАВРЕМЯ(1, 1, 1) КАК Период
			|ПОМЕСТИТЬ Представления_Периоды
			|ГДЕ
			|	""НачалоИнтервала"" = &НачалоПериода
			|	И ""ОкончаниеИнтервала"" = &КонецПериода
			|	И ""Периодичность"" = ""МЕСЯЦ""
			|	И ""ИспользоватьКонецПериода"" = ЛОЖЬ
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	ВзаиморасчетыССотрудниками.Сотрудник КАК Сотрудник,
			|	ВзаиморасчетыССотрудниками.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВзаиморасчетыССотрудниками.СтатьяФинансирования КАК СтатьяФинансирования,
			|	ВзаиморасчетыССотрудниками.СтатьяРасходов КАК СтатьяРасходов,
			|	ВзаиморасчетыССотрудниками.Организация КАК Организация,
			|	ВзаиморасчетыССотрудниками.Подразделение КАК Подразделение,
			|	ВзаиморасчетыССотрудниками.СуммаВзаиморасчетовНачальныйОстаток КАК НачальныйОстаток,
			|	ВзаиморасчетыССотрудниками.СуммаВзаиморасчетовКонечныйОстаток КАК КонечныйОстаток,
			|	ВзаиморасчетыССотрудниками.Период КАК Период
			|ПОМЕСТИТЬ ВТОстаткиИОборотыВзаиморасчетыССотрудниками
			|ИЗ
			|	РегистрНакопления.ВзаиморасчетыССотрудниками.ОстаткиИОбороты(&НачалоПериода {(&НачалоПериода)}, &КонецПериода {(&КонецПериода)}, Месяц, , {(Сотрудник), (ФизическоеЛицо), (Организация)}) КАК ВзаиморасчетыССотрудниками
			|{ГДЕ
			|	ВзаиморасчетыССотрудниками.Организация.*,
			|	ВзаиморасчетыССотрудниками.Сотрудник.*,
			|	ВзаиморасчетыССотрудниками.ФизическоеЛицо.*,
			|	ВзаиморасчетыССотрудниками.СтатьяФинансирования.*,
			|	ВзаиморасчетыССотрудниками.СтатьяРасходов.*,
			|	ВзаиморасчетыССотрудниками.Подразделение.*}
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	НАЧАЛОПЕРИОДА(НачисленияИУдержания.Период, МЕСЯЦ) КАК МесяцНачисления,
			|	НачисленияИУдержания.Период КАК Период,
			|	НачисленияИУдержания.ФизическоеЛицо КАК ФизическоеЛицо,
			|	НачисленияИУдержания.СтатьяФинансирования КАК СтатьяФинансирования,
			|	НачисленияИУдержания.СтатьяРасходов КАК СтатьяРасходов,
			|	НачисленияИУдержания.Подразделение КАК Подразделение,
			|	НачисленияИУдержания.ГруппаНачисленияУдержанияВыплаты КАК Группа,
			|	НачисленияИУдержания.НачислениеУдержание КАК ВидРасчета,
			|	СУММА(НачисленияИУдержания.Сумма) КАК Сумма,
			|	НачисленияИУдержания.Организация КАК Организация,
			|	НачисленияИУдержания.Сотрудник КАК Сотрудник,
			|	НачисленияИУдержания.ДатаНачала КАК ДатаНачала,
			|	НачисленияИУдержания.ДатаОкончания КАК ДатаОкончания,
			|	ВЫРАЗИТЬ(НачисленияИУдержания.Сотрудник КАК Справочник.Сотрудники).ГоловнойСотрудник КАК ГоловнойСотрудник,
			|	НачисленияИУдержания.ПериодДействия КАК ПериодДействия,
			|	НачисленияИУдержания.Регистратор КАК Регистратор,
			|	НачисленияИУдержания.ИдентификаторСтроки КАК ИдентификаторСтроки,
			|	НачисленияИУдержания.Сторно КАК Сторно
			|ПОМЕСТИТЬ ВТНачисленияИУдержания
			|ИЗ
			|	РегистрНакопления.НачисленияУдержанияПоСотрудникамАвансом КАК НачисленияИУдержания
			|ГДЕ
			|	НачисленияИУдержания.Период МЕЖДУ &НачалоПериода И &КонецПериода
			|{ГДЕ
			|	НачисленияИУдержания.Сотрудник.*,
			|	НачисленияИУдержания.ФизическоеЛицо.*,
			|	НачисленияИУдержания.Организация.*,
			|	НачисленияИУдержания.Сотрудник.ГоловнойСотрудник.* КАК ГоловнойСотрудник}
			|
			|СГРУППИРОВАТЬ ПО
			|	НачисленияИУдержания.Период,
			|	НачисленияИУдержания.ФизическоеЛицо,
			|	НачисленияИУдержания.СтатьяФинансирования,
			|	НачисленияИУдержания.СтатьяРасходов,
			|	НачисленияИУдержания.Подразделение,
			|	НачисленияИУдержания.ГруппаНачисленияУдержанияВыплаты,
			|	НачисленияИУдержания.НачислениеУдержание,
			|	НачисленияИУдержания.Организация,
			|	НачисленияИУдержания.Сотрудник,
			|	НачисленияИУдержания.ДатаНачала,
			|	НачисленияИУдержания.ДатаОкончания,
			|	ВЫРАЗИТЬ(НачисленияИУдержания.Сотрудник КАК Справочник.Сотрудники).ГоловнойСотрудник,
			|	НачисленияИУдержания.Регистратор,
			|	НАЧАЛОПЕРИОДА(НачисленияИУдержания.Период, МЕСЯЦ),
			|	НачисленияИУдержания.ПериодДействия,
			|	НачисленияИУдержания.ИдентификаторСтроки,
			|	НачисленияИУдержания.Сторно
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
			|	ВзаиморасчетыССотрудниками.Организация КАК Организация,
			|	ВзаиморасчетыССотрудниками.Сотрудник КАК Сотрудник,
			|	ВзаиморасчетыССотрудниками.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВзаиморасчетыССотрудниками.СтатьяФинансирования КАК СтатьяФинансирования,
			|	ВзаиморасчетыССотрудниками.СтатьяРасходов КАК СтатьяРасходов,
			|	ВзаиморасчетыССотрудниками.Подразделение КАК Подразделение,
			|	КОНЕЦПЕРИОДА(ВзаиморасчетыССотрудниками.Период, МЕСЯЦ) КАК Период
			|ПОМЕСТИТЬ ВТВсеСотрудникиСПериодом
			|ИЗ
			|	ВТОстаткиИОборотыВзаиморасчетыССотрудниками КАК ВзаиморасчетыССотрудниками
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	НачисленияИУдержания.Организация,
			|	НачисленияИУдержания.Сотрудник,
			|	НачисленияИУдержания.ФизическоеЛицо,
			|	НачисленияИУдержания.СтатьяФинансирования,
			|	НачисленияИУдержания.СтатьяРасходов,
			|	НачисленияИУдержания.Подразделение,
			|	КОНЕЦПЕРИОДА(НачисленияИУдержания.Период, МЕСЯЦ)
			|ИЗ
			|	ВТНачисленияИУдержания КАК НачисленияИУдержания
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	НачисленияИУдержания.Организация,
			|	НачисленияИУдержания.Сотрудник,
			|	НачисленияИУдержания.ФизическоеЛицо,
			|	НачисленияИУдержания.СтатьяФинансирования,
			|	НачисленияИУдержания.СтатьяРасходов,
			|	НачисленияИУдержания.Подразделение,
			|	НачисленияИУдержания.ПериодДействия
			|ИЗ
			|	ВТНачисленияИУдержания КАК НачисленияИУдержания
			|ГДЕ
			|	НачисленияИУдержания.ПериодДействия <> ДАТАВРЕМЯ(1, 1, 1)
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ОстаткиИОбороты.Организация КАК Организация,
			|	ОстаткиИОбороты.Сотрудник КАК Сотрудник,
			|	ОстаткиИОбороты.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ОстаткиИОбороты.Подразделение КАК Подразделение,
			|	ОстаткиИОбороты.СтатьяФинансирования КАК СтатьяФинансирования,
			|	ОстаткиИОбороты.СтатьяРасходов КАК СтатьяРасходов,
			|	ОстаткиИОбороты.Период КАК Период
			|ПОМЕСТИТЬ ВТВсеПериодомКадровыхДанных
			|ИЗ
			|	ВТВсеСотрудникиСПериодом КАК ОстаткиИОбороты
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ОстаткиИОбороты.Организация,
			|	ОстаткиИОбороты.Сотрудник,
			|	ОстаткиИОбороты.ФизическоеЛицо,
			|	ОстаткиИОбороты.Подразделение,
			|	ОстаткиИОбороты.СтатьяФинансирования,
			|	ОстаткиИОбороты.СтатьяРасходов,
			|	Месяцы.Период
			|ИЗ
			|	ВТВсеСотрудникиСПериодом КАК ОстаткиИОбороты
			|		ЛЕВОЕ СОЕДИНЕНИЕ Представления_Периоды КАК Месяцы
			|		ПО (ИСТИНА)
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ОстаткиИОбороты.Организация,
			|	ОстаткиИОбороты.Сотрудник,
			|	ОстаткиИОбороты.ФизическоеЛицо,
			|	ОстаткиИОбороты.Подразделение,
			|	ОстаткиИОбороты.СтатьяФинансирования,
			|	ОстаткиИОбороты.СтатьяРасходов,
			|	КОНЕЦПЕРИОДА(Месяцы.Период, МЕСЯЦ)
			|ИЗ
			|	ВТВсеСотрудникиСПериодом КАК ОстаткиИОбороты
			|		ЛЕВОЕ СОЕДИНЕНИЕ Представления_Периоды КАК Месяцы
			|		ПО (ИСТИНА)
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ОстаткиИОбороты.Организация КАК Организация,
			|	ОстаткиИОбороты.Сотрудник КАК Сотрудник,
			|	ОстаткиИОбороты.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ОстаткиИОбороты.Подразделение КАК Подразделение,
			|	ОстаткиИОбороты.СтатьяФинансирования КАК СтатьяФинансирования,
			|	ОстаткиИОбороты.СтатьяРасходов КАК СтатьяРасходов,
			|	Месяцы.Период КАК Месяц
			|ПОМЕСТИТЬ ВТСотрудникиМесяцы
			|ИЗ
			|	ВТВсеСотрудникиСПериодом КАК ОстаткиИОбороты
			|		ЛЕВОЕ СОЕДИНЕНИЕ Представления_Периоды КАК Месяцы
			|		ПО (ИСТИНА)
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
			|	ДАТАВРЕМЯ(1, 1, 1) КАК Период,
			|	ЗНАЧЕНИЕ(Справочник.Сотрудники.ПустаяСсылка) КАК Сотрудник,
			|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) КАК Организация,
			|	ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка) КАК Подразделение,
			|	ЗНАЧЕНИЕ(Справочник.Должности.ПустаяСсылка) КАК Должность,
			|	ЗНАЧЕНИЕ(Справочник.РазрядыКатегорииДолжностей.ПустаяСсылка) КАК РазрядКатегория,
			|	ЗНАЧЕНИЕ(Перечисление.ВидыЗанятости.ПустаяСсылка) КАК ВидЗанятости,
			|	"""" КАК Фамилия,
			|	"""" КАК Имя,
			|	"""" КАК Отчество,
			|	0 КАК ТарифнаяСтавка,
			|	0 КАК ТекущаяТарифнаяСтавка,
			|	ДАТАВРЕМЯ(1, 1, 1) КАК ДатаУвольнения
			|ПОМЕСТИТЬ Представления_КадровыеДанныеСотрудников
			|ИЗ
			|	ВТВсеПериодомКадровыхДанных КАК Сотрудники
			|ГДЕ
			|	""ТолькоРазрешенные"" = ИСТИНА
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СотрудникиМесяцы.Организация КАК Организация,
			|	СотрудникиМесяцы.Сотрудник КАК Сотрудник,
			|	СотрудникиМесяцы.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СотрудникиМесяцы.СтатьяФинансирования КАК СтатьяФинансирования,
			|	СотрудникиМесяцы.СтатьяРасходов КАК СтатьяРасходов,
			|	СотрудникиМесяцы.Подразделение КАК Подразделение,
			|	СотрудникиМесяцы.Месяц КАК Месяц,
			|	МАКСИМУМ(ОстаткиИОбороты.Период) КАК ПоследнийМесяцОстатков
			|ПОМЕСТИТЬ ВТСотрудникиМесяцыОстатков
			|ИЗ
			|	ВТСотрудникиМесяцы КАК СотрудникиМесяцы
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОстаткиИОборотыВзаиморасчетыССотрудниками КАК ОстаткиИОбороты
			|		ПО СотрудникиМесяцы.Организация = ОстаткиИОбороты.Организация
			|			И СотрудникиМесяцы.Сотрудник = ОстаткиИОбороты.Сотрудник
			|			И СотрудникиМесяцы.ФизическоеЛицо = ОстаткиИОбороты.ФизическоеЛицо
			|			И СотрудникиМесяцы.Подразделение = ОстаткиИОбороты.Подразделение
			|			И СотрудникиМесяцы.СтатьяФинансирования = ОстаткиИОбороты.СтатьяФинансирования
			|			И СотрудникиМесяцы.СтатьяРасходов = ОстаткиИОбороты.СтатьяРасходов
			|			И СотрудникиМесяцы.Месяц >= ОстаткиИОбороты.Период
			|
			|СГРУППИРОВАТЬ ПО
			|	СотрудникиМесяцы.Организация,
			|	СотрудникиМесяцы.Сотрудник,
			|	СотрудникиМесяцы.ФизическоеЛицо,
			|	СотрудникиМесяцы.СтатьяФинансирования,
			|	СотрудникиМесяцы.СтатьяРасходов,
			|	СотрудникиМесяцы.Подразделение,
			|	СотрудникиМесяцы.Месяц
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	СотрудникиМесяцыОстатков.Организация КАК Организация,
			|	СотрудникиМесяцыОстатков.Сотрудник КАК Сотрудник,
			|	СотрудникиМесяцыОстатков.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СотрудникиМесяцыОстатков.СтатьяФинансирования КАК СтатьяФинансирования,
			|	СотрудникиМесяцыОстатков.СтатьяРасходов КАК СтатьяРасходов,
			|	СотрудникиМесяцыОстатков.Подразделение КАК Подразделение,
			|	ЕСТЬNULL(ВЫБОР
			|			КОГДА СотрудникиМесяцыОстатков.Месяц = ОстаткиИОбороты.Период
			|				ТОГДА ОстаткиИОбороты.НачальныйОстаток
			|			ИНАЧЕ ОстаткиИОбороты.КонечныйОстаток
			|		КОНЕЦ, 0) КАК НачальныйОстаток,
			|	КОНЕЦПЕРИОДА(СотрудникиМесяцыОстатков.Месяц, МЕСЯЦ) КАК Период
			|ПОМЕСТИТЬ ВТСальдоВсеСотрудникиПериоды
			|ИЗ
			|	ВТСотрудникиМесяцыОстатков КАК СотрудникиМесяцыОстатков
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОстаткиИОборотыВзаиморасчетыССотрудниками КАК ОстаткиИОбороты
			|		ПО СотрудникиМесяцыОстатков.Организация = ОстаткиИОбороты.Организация
			|			И СотрудникиМесяцыОстатков.Сотрудник = ОстаткиИОбороты.Сотрудник
			|			И СотрудникиМесяцыОстатков.ФизическоеЛицо = ОстаткиИОбороты.ФизическоеЛицо
			|			И СотрудникиМесяцыОстатков.Подразделение = ОстаткиИОбороты.Подразделение
			|			И СотрудникиМесяцыОстатков.СтатьяФинансирования = ОстаткиИОбороты.СтатьяФинансирования
			|			И СотрудникиМесяцыОстатков.СтатьяРасходов = ОстаткиИОбороты.СтатьяРасходов
			|			И СотрудникиМесяцыОстатков.ПоследнийМесяцОстатков = ОстаткиИОбороты.Период
			|ГДЕ
			|	НЕ ОстаткиИОбороты.НачальныйОстаток ЕСТЬ NULL
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	ВзаиморасчетыССотрудниками.Сотрудник КАК Сотрудник,
			|	ВЫРАЗИТЬ(ВзаиморасчетыССотрудниками.Сотрудник КАК Справочник.Сотрудники).ГоловнойСотрудник КАК ГоловнойСотрудник,
			|	КадровыеДанныеСотрудниковНаКонецПериода.Должность КАК ДолжностьГоловногоСотрудникаНаКонецПериода,
			|	КадровыеДанныеСотрудниковНаКонецПериода.РазрядКатегория КАК РазрядКатегорияГоловногоСотрудникаНаКонецПериода,
			|	КадровыеДанныеСотрудниковНаКонецПериода.Организация КАК ОрганизацияГоловногоСотрудникаНаКонецПериода,
			|	КадровыеДанныеСотрудниковНаКонецПериода.Подразделение КАК ПодразделениеГоловногоСотрудникаНаКонецПериода,
			|	КадровыеДанныеСотрудниковНаКонецПериода.ВидЗанятости КАК ВидЗанятостиГоловногоСотрудникаНаКонецПериода,
			|	ВзаиморасчетыССотрудниками.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВзаиморасчетыССотрудниками.СтатьяФинансирования КАК СтатьяФинансирования,
			|	ВзаиморасчетыССотрудниками.СтатьяРасходов КАК СтатьяРасходов,
			|	ВзаиморасчетыССотрудниками.Организация КАК Организация,
			|	ВзаиморасчетыССотрудниками.Подразделение КАК Подразделение,
			|	ВзаиморасчетыССотрудниками.НачальныйОстаток КАК НачальныйОстаток,
			|	НАЧАЛОПЕРИОДА(ВзаиморасчетыССотрудниками.Период, МЕСЯЦ) КАК Период,
			|	КадровыеДанныеСотрудниковНаКонецПериода.Подразделение КАК ПодразделениеНаКонецПериода,
			|	КадровыеДанныеСотрудниковНаКонецПериода.ВидЗанятости КАК ВидЗанятостиНаКонецПериода,
			|	КадровыеДанныеСотрудников.Фамилия КАК Фамилия,
			|	КадровыеДанныеСотрудников.Имя КАК Имя,
			|	КадровыеДанныеСотрудников.Отчество КАК Отчество,
			|	КадровыеДанныеСотрудников.Должность КАК Должность,
			|	КадровыеДанныеСотрудников.РазрядКатегория КАК РазрядКатегория,
			|	КадровыеДанныеСотрудниковНаКонецПериода.Должность КАК ДолжностьНаКонецПериода,
			|	КадровыеДанныеСотрудниковНаКонецПериода.РазрядКатегория КАК РазрядКатегорияНаКонецПериода,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеСотрудниковНаКонецПериода.ДатаУвольнения <> ДАТАВРЕМЯ(1, 1, 1)
			|				И КадровыеДанныеСотрудниковНаКонецПериода.ДатаУвольнения <= КадровыеДанныеСотрудниковНаКонецПериода.Период
			|			ТОГДА КадровыеДанныеСотрудниковНаКонецПериода.ТекущаяТарифнаяСтавка
			|		ИНАЧЕ КадровыеДанныеСотрудниковНаКонецПериода.ТарифнаяСтавка
			|	КОНЕЦ КАК ТарифнаяСтавка,
			|	КадровыеДанныеСотрудников.ВидЗанятости КАК ВидЗанятости,
			|	КадровыеДанныеСотрудников.ДатаУвольнения КАК ДатаУвольнения
			|ПОМЕСТИТЬ ВТСальдоПоРасчетамССотрудниками
			|ИЗ
			|	ВТСальдоВсеСотрудникиПериоды КАК ВзаиморасчетыССотрудниками
			|		{ЛЕВОЕ СОЕДИНЕНИЕ Представления_КадровыеДанныеСотрудников КАК КадровыеДанныеСотрудниковНаКонецПериода
			|		ПО ВзаиморасчетыССотрудниками.Сотрудник = КадровыеДанныеСотрудниковНаКонецПериода.Сотрудник
			|			И (КОНЕЦПЕРИОДА(ВзаиморасчетыССотрудниками.Период, МЕСЯЦ) = КадровыеДанныеСотрудниковНаКонецПериода.Период)}
			|		{ЛЕВОЕ СОЕДИНЕНИЕ Представления_КадровыеДанныеСотрудников КАК КадровыеДанныеСотрудников
			|		ПО ВзаиморасчетыССотрудниками.Сотрудник = КадровыеДанныеСотрудников.Сотрудник
			|			И ВзаиморасчетыССотрудниками.Период = КадровыеДанныеСотрудников.Период}
			|ГДЕ
			|	ВзаиморасчетыССотрудниками.НачальныйОстаток <> 0
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	НачисленияИУдержания.МесяцНачисления КАК МесяцНачисления,
			|	НачисленияИУдержания.ФизическоеЛицо КАК ФизическоеЛицо,
			|	НачисленияИУдержания.СтатьяФинансирования КАК СтатьяФинансирования,
			|	НачисленияИУдержания.СтатьяРасходов КАК СтатьяРасходов,
			|	НачисленияИУдержания.Подразделение КАК Подразделение,
			|	НачисленияИУдержания.Группа КАК Группа,
			|	НачисленияИУдержания.ВидРасчета КАК ВидРасчета,
			|	НачисленияИУдержания.Сумма КАК Сумма,
			|	НачисленияИУдержания.Организация КАК Организация,
			|	НачисленияИУдержания.Сотрудник КАК Сотрудник,
			|	НачисленияИУдержания.ДатаНачала КАК ДатаНачала,
			|	НачисленияИУдержания.ДатаОкончания КАК ДатаОкончания,
			|	НачисленияИУдержания.ГоловнойСотрудник КАК ГоловнойСотрудник,
			|	КадровыеДанныеГоловныхСотрудников.Фамилия КАК Фамилия,
			|	КадровыеДанныеГоловныхСотрудников.Имя КАК Имя,
			|	КадровыеДанныеГоловныхСотрудников.Отчество КАК Отчество,
			|	КадровыеДанныеГоловныхСотрудников.Должность КАК ДолжностьГоловногоСотрудникаНаКонецПериода,
			|	КадровыеДанныеГоловныхСотрудников.РазрядКатегория КАК РазрядКатегорияГоловногоСотрудникаНаКонецПериода,
			|	КадровыеДанныеГоловныхСотрудников.Организация КАК ОрганизацияГоловногоСотрудникаНаКонецПериода,
			|	КадровыеДанныеГоловныхСотрудников.Подразделение КАК ПодразделениеГоловногоСотрудникаНаКонецПериода,
			|	КадровыеДанныеГоловныхСотрудников.ВидЗанятости КАК ВидЗанятостиГоловногоСотрудникаНаКонецПериода,
			|	НачисленияИУдержания.ПериодДействия КАК ПериодДействия,
			|	НачисленияИУдержания.Регистратор КАК Регистратор,
			|	КадровыеДанныеСотрудниковНаКонецПериода.Подразделение КАК ПодразделениеНаКонецПериода,
			|	КадровыеДанныеСотрудниковНаКонецПериода.ВидЗанятости КАК ВидЗанятостиНаКонецПериода,
			|	КадровыеДанныеСотрудниковНаКонецПериода.Должность КАК ДолжностьНаКонецПериода,
			|	КадровыеДанныеСотрудниковНаКонецПериода.РазрядКатегория КАК РазрядКатегорияНаКонецПериода,
			|	КадровыеДанныеСотрудников.Должность КАК Должность,
			|	КадровыеДанныеСотрудников.РазрядКатегория КАК РазрядКатегория,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеСотрудниковНаКонецПериода.ДатаУвольнения <> ДАТАВРЕМЯ(1, 1, 1)
			|				И КадровыеДанныеСотрудниковНаКонецПериода.ДатаУвольнения <= КадровыеДанныеСотрудниковНаКонецПериода.Период
			|			ТОГДА КадровыеДанныеСотрудниковНаКонецПериода.ТекущаяТарифнаяСтавка
			|		ИНАЧЕ КадровыеДанныеСотрудниковНаКонецПериода.ТарифнаяСтавка
			|	КОНЕЦ КАК ТарифнаяСтавкаНаКонецПериода,
			|	КадровыеДанныеСотрудников.ТарифнаяСтавка КАК ТарифнаяСтавка,
			|	КадровыеДанныеСотрудников.ВидЗанятости КАК ВидЗанятости,
			|	NULL КАК Показатель,
			|	NULL КАК Значение,
			|	КадровыеДанныеГоловныхСотрудников.ДатаУвольнения КАК ДатаУвольнения,
			|	НачисленияИУдержания.ИдентификаторСтроки КАК ИдентификаторСтроки,
			|	НачисленияИУдержания.Сторно КАК Сторно
			|ПОМЕСТИТЬ ВТНачисленияИУдержанияСКадровымиДанными
			|ИЗ
			|	ВТНачисленияИУдержания КАК НачисленияИУдержания
			|		{ЛЕВОЕ СОЕДИНЕНИЕ Представления_КадровыеДанныеСотрудников КАК КадровыеДанныеСотрудниковНаКонецПериода
			|		ПО НачисленияИУдержания.Сотрудник = КадровыеДанныеСотрудниковНаКонецПериода.Сотрудник
			|			И (КОНЕЦПЕРИОДА(НачисленияИУдержания.Период, МЕСЯЦ) = КадровыеДанныеСотрудниковНаКонецПериода.Период)}
			|		{ЛЕВОЕ СОЕДИНЕНИЕ Представления_КадровыеДанныеСотрудников КАК КадровыеДанныеСотрудников
			|		ПО НачисленияИУдержания.Сотрудник = КадровыеДанныеСотрудников.Сотрудник
			|			И (ВЫБОР
			|				КОГДА НачисленияИУдержания.ДатаНачала = ДАТАВРЕМЯ(1, 1, 1)
			|					ТОГДА КОНЕЦПЕРИОДА(НачисленияИУдержания.Период, МЕСЯЦ)
			|				ИНАЧЕ НачисленияИУдержания.ДатаНачала
			|			КОНЕЦ = КадровыеДанныеСотрудников.Период)}
			|		{ЛЕВОЕ СОЕДИНЕНИЕ Представления_КадровыеДанныеСотрудников КАК КадровыеДанныеГоловныхСотрудников
			|		ПО (ВЫРАЗИТЬ(НачисленияИУдержания.Сотрудник КАК Справочник.Сотрудники).ГоловнойСотрудник = КадровыеДанныеГоловныхСотрудников.Сотрудник)
			|			И (КОНЕЦПЕРИОДА(НачисленияИУдержания.Период, МЕСЯЦ) = КадровыеДанныеГоловныхСотрудников.Период)}
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	НАЧАЛОПЕРИОДА(ОтработанноеВремя.Период, МЕСЯЦ) КАК МесяцНачисления,
			|	ОтработанноеВремя.ПериодДействия КАК ПериодДействия,
			|	ОтработанноеВремя.Регистратор КАК Регистратор,
			|	ОтработанноеВремя.Сотрудник КАК Сотрудник,
			|	ОтработанноеВремя.Подразделение КАК Подразделение,
			|	ОтработанноеВремя.Начисление КАК ВидРасчета,
			|	ЛОЖЬ КАК ВремяВЧасах,
			|	ОтработанноеВремя.ДатаНачала КАК ДатаНачала,
			|	СУММА(ОтработанноеВремя.ОтработаноДней) КАК ОтработаноДней,
			|	СУММА(ОтработанноеВремя.ОтработаноЧасов) КАК ОтработаноЧасов,
			|	СУММА(ОтработанноеВремя.ОплаченоДней) КАК ОплаченоДней,
			|	СУММА(ОтработанноеВремя.ОплаченоЧасов) КАК ОплаченоЧасов,
			|	ОтработанноеВремя.ИдентификаторСтроки КАК ИдентификаторСтроки
			|ПОМЕСТИТЬ ВТОтработанноеВремяВПериодах
			|ИЗ
			|	РегистрНакопления.ОтработанноеВремяПоСотрудникамАвансом КАК ОтработанноеВремя
			|ГДЕ
			|	ОтработанноеВремя.Период МЕЖДУ &НачалоПериода И &КонецПериода
			|{ГДЕ
			|	ОтработанноеВремя.Сотрудник.*,
			|	ОтработанноеВремя.ФизическоеЛицо.*,
			|	ОтработанноеВремя.Организация.*,
			|	ОтработанноеВремя.Сотрудник.ГоловнойСотрудник.* КАК ГоловнойСотрудник}
			|
			|СГРУППИРОВАТЬ ПО
			|	ОтработанноеВремя.Регистратор,
			|	ОтработанноеВремя.Сотрудник,
			|	ОтработанноеВремя.Подразделение,
			|	ОтработанноеВремя.Начисление,
			|	НАЧАЛОПЕРИОДА(ОтработанноеВремя.Период, МЕСЯЦ),
			|	ОтработанноеВремя.ПериодДействия,
			|	ОтработанноеВремя.ДатаНачала,
			|	ОтработанноеВремя.ИдентификаторСтроки
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	ОтработанноеВремя.МесяцНачисления КАК МесяцНачисления,
			|	ОтработанноеВремя.ПериодДействия КАК ПериодДействия,
			|	ОтработанноеВремя.Регистратор КАК Регистратор,
			|	ОтработанноеВремя.Сотрудник КАК Сотрудник,
			|	ОтработанноеВремя.Подразделение КАК Подразделение,
			|	ОтработанноеВремя.ВидРасчета КАК ВидРасчета,
			|	ОтработанноеВремя.ОтработаноДней КАК ОтработаноДней,
			|	ОтработанноеВремя.ОтработаноЧасов КАК ОтработаноЧасов,
			|	ОтработанноеВремя.ОплаченоДней КАК ОплаченоДней,
			|	ОтработанноеВремя.ОплаченоЧасов КАК ОплаченоЧасов,
			|	ОтработанноеВремя.ВремяВЧасах КАК ВремяВЧасах,
			|	ОтработанноеВремя.ДатаНачала КАК ДатаНачала,
			|	НачисленияИУдержания.СтатьяФинансирования КАК СтатьяФинансирования,
			|	НачисленияИУдержания.СтатьяРасходов КАК СтатьяРасходов,
			|	ОтработанноеВремя.ИдентификаторСтроки КАК ИдентификаторСтроки
			|ПОМЕСТИТЬ ВТОтработанноеВремяСНачислениями
			|ИЗ
			|	ВТОтработанноеВремяВПериодах КАК ОтработанноеВремя
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНачисленияИУдержания КАК НачисленияИУдержания
			|		ПО (ОтработанноеВремя.МесяцНачисления = НАЧАЛОПЕРИОДА(НачисленияИУдержания.Период, МЕСЯЦ))
			|			И ОтработанноеВремя.Регистратор = НачисленияИУдержания.Регистратор
			|			И ОтработанноеВремя.Сотрудник = НачисленияИУдержания.Сотрудник
			|			И ОтработанноеВремя.Подразделение = НачисленияИУдержания.Подразделение
			|			И ОтработанноеВремя.ВидРасчета = НачисленияИУдержания.ВидРасчета
			|			И ОтработанноеВремя.ИдентификаторСтроки = НачисленияИУдержания.ИдентификаторСтроки
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	ОтработанноеВремя.МесяцНачисления КАК МесяцНачисления,
			|	ОтработанноеВремя.ПериодДействия КАК ПериодДействия,
			|	ОтработанноеВремя.Регистратор КАК Регистратор,
			|	ОтработанноеВремя.Сотрудник КАК Сотрудник,
			|	ОтработанноеВремя.Подразделение КАК Подразделение,
			|	ОтработанноеВремя.ВидРасчета КАК ВидРасчета,
			|	ОтработанноеВремя.ОтработаноДней КАК ОтработаноДней,
			|	ОтработанноеВремя.ОтработаноЧасов КАК ОтработаноЧасов,
			|	ОтработанноеВремя.ОплаченоДней КАК ОплаченоДней,
			|	ОтработанноеВремя.ОплаченоЧасов КАК ОплаченоЧасов,
			|	ОтработанноеВремя.ДатаНачала КАК ДатаНачала,
			|	ОтработанноеВремя.ВремяВЧасах КАК ВремяВЧасах,
			|	МИНИМУМ(ОтработанноеВремя.СтатьяФинансирования) КАК СтатьяФинансирования,
			|	ОтработанноеВремя.ИдентификаторСтроки КАК ИдентификаторСтроки
			|ПОМЕСТИТЬ ВТОтработанноеВремяСоСтатьейФинансирования
			|ИЗ
			|	ВТОтработанноеВремяСНачислениями КАК ОтработанноеВремя
			|
			|СГРУППИРОВАТЬ ПО
			|	ОтработанноеВремя.МесяцНачисления,
			|	ОтработанноеВремя.ПериодДействия,
			|	ОтработанноеВремя.Регистратор,
			|	ОтработанноеВремя.Сотрудник,
			|	ОтработанноеВремя.Подразделение,
			|	ОтработанноеВремя.ВидРасчета,
			|	ОтработанноеВремя.ОтработаноДней,
			|	ОтработанноеВремя.ОтработаноЧасов,
			|	ОтработанноеВремя.ОплаченоДней,
			|	ОтработанноеВремя.ОплаченоЧасов,
			|	ОтработанноеВремя.ДатаНачала,
			|	ОтработанноеВремя.ВремяВЧасах,
			|	ОтработанноеВремя.ИдентификаторСтроки
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	ОтработанноеВремя.МесяцНачисления КАК МесяцНачисления,
			|	ОтработанноеВремя.ПериодДействия КАК ПериодДействия,
			|	ОтработанноеВремя.Регистратор КАК Регистратор,
			|	ОтработанноеВремя.Сотрудник КАК Сотрудник,
			|	ОтработанноеВремя.Подразделение КАК Подразделение,
			|	ОтработанноеВремя.ВидРасчета КАК ВидРасчета,
			|	ОтработанноеВремя.ОтработаноДней КАК ОтработаноДней,
			|	ОтработанноеВремя.ОтработаноЧасов КАК ОтработаноЧасов,
			|	ОтработанноеВремя.ОплаченоДней КАК ОплаченоДней,
			|	ОтработанноеВремя.ОплаченоЧасов КАК ОплаченоЧасов,
			|	ОтработанноеВремя.ДатаНачала КАК ДатаНачала,
			|	ОтработанноеВремя.СтатьяФинансирования КАК СтатьяФинансирования,
			|	ОтработанноеВремя.ВремяВЧасах КАК ВремяВЧасах,
			|	МИНИМУМ(ОтработанноеВремя.СтатьяРасходов) КАК СтатьяРасходов,
			|	ОтработанноеВремя.ИдентификаторСтроки КАК ИдентификаторСтроки
			|ПОМЕСТИТЬ ВТОтработанноеВремя
			|ИЗ
			|	ВТОтработанноеВремяСНачислениями КАК ОтработанноеВремя
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтработанноеВремяСоСтатьейФинансирования КАК ОтработанноеВремяСоСтатьейФинансирования
			|		ПО ОтработанноеВремя.МесяцНачисления = ОтработанноеВремяСоСтатьейФинансирования.МесяцНачисления
			|			И ОтработанноеВремя.ПериодДействия = ОтработанноеВремяСоСтатьейФинансирования.ПериодДействия
			|			И ОтработанноеВремя.Регистратор = ОтработанноеВремяСоСтатьейФинансирования.Регистратор
			|			И ОтработанноеВремя.Сотрудник = ОтработанноеВремяСоСтатьейФинансирования.Сотрудник
			|			И ОтработанноеВремя.Подразделение = ОтработанноеВремяСоСтатьейФинансирования.Подразделение
			|			И ОтработанноеВремя.ВидРасчета = ОтработанноеВремяСоСтатьейФинансирования.ВидРасчета
			|			И ОтработанноеВремя.ДатаНачала = ОтработанноеВремяСоСтатьейФинансирования.ДатаНачала
			|			И ОтработанноеВремя.СтатьяФинансирования = ОтработанноеВремяСоСтатьейФинансирования.СтатьяФинансирования
			|			И ОтработанноеВремя.ВремяВЧасах = ОтработанноеВремяСоСтатьейФинансирования.ВремяВЧасах
			|
			|СГРУППИРОВАТЬ ПО
			|	ОтработанноеВремя.МесяцНачисления,
			|	ОтработанноеВремя.ПериодДействия,
			|	ОтработанноеВремя.Регистратор,
			|	ОтработанноеВремя.Сотрудник,
			|	ОтработанноеВремя.Подразделение,
			|	ОтработанноеВремя.ВидРасчета,
			|	ОтработанноеВремя.ОтработаноДней,
			|	ОтработанноеВремя.ОтработаноЧасов,
			|	ОтработанноеВремя.ОплаченоДней,
			|	ОтработанноеВремя.ОплаченоЧасов,
			|	ОтработанноеВремя.ДатаНачала,
			|	ОтработанноеВремя.СтатьяФинансирования,
			|	ОтработанноеВремя.ВремяВЧасах,
			|	ОтработанноеВремя.ИдентификаторСтроки
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	МИНИМУМ(СальдоПоРасчетамССотрудниками.Период) КАК ПервыйМесяц,
			|	МАКСИМУМ(СальдоПоРасчетамССотрудниками.Период) КАК ПоследнийМесяц,
			|	СальдоПоРасчетамССотрудниками.Организация КАК Организация,
			|	СальдоПоРасчетамССотрудниками.Сотрудник КАК Сотрудник,
			|	СальдоПоРасчетамССотрудниками.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СальдоПоРасчетамССотрудниками.Подразделение КАК Подразделение,
			|	СальдоПоРасчетамССотрудниками.СтатьяФинансирования КАК СтатьяФинансирования,
			|	СальдоПоРасчетамССотрудниками.СтатьяРасходов КАК СтатьяРасходов
			|ПОМЕСТИТЬ ВТПоследниеПервыеМесяцы
			|ИЗ
			|	ВТСальдоПоРасчетамССотрудниками КАК СальдоПоРасчетамССотрудниками
			|
			|СГРУППИРОВАТЬ ПО
			|	СальдоПоРасчетамССотрудниками.Организация,
			|	СальдоПоРасчетамССотрудниками.Сотрудник,
			|	СальдоПоРасчетамССотрудниками.ФизическоеЛицо,
			|	СальдоПоРасчетамССотрудниками.Подразделение,
			|	СальдоПоРасчетамССотрудниками.СтатьяФинансирования,
			|	СальдоПоРасчетамССотрудниками.СтатьяРасходов
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	НАЧАЛОПЕРИОДА(ВзаиморасчетыССотрудниками.Период, МЕСЯЦ) КАК МесяцНачисления,
			|	ВзаиморасчетыССотрудниками.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВзаиморасчетыССотрудниками.СтатьяФинансирования КАК СтатьяФинансирования,
			|	ВзаиморасчетыССотрудниками.СтатьяРасходов КАК СтатьяРасходов,
			|	ВзаиморасчетыССотрудниками.Подразделение КАК Подразделение,
			|	ВзаиморасчетыССотрудниками.ГруппаНачисленияУдержанияВыплаты КАК Группа,
			|	ВзаиморасчетыССотрудниками.ВидВзаиморасчетов КАК ВидРасчета,
			|	ВзаиморасчетыССотрудниками.СуммаВзаиморасчетов КАК Сумма,
			|	ВЫБОР
			|		КОГДА НЕ ВзаиморасчетыССотрудниками.Подразделение.Владелец ЕСТЬ NULL
			|			ТОГДА ВзаиморасчетыССотрудниками.Подразделение.Владелец
			|		КОГДА КадровыеДанныеСотрудников.Организация <> ЗНАЧЕНИЕ(СПРАВОЧНИК.Организации.ПустаяСсылка)
			|			ТОГДА КадровыеДанныеСотрудников.Организация
			|		ИНАЧЕ ВзаиморасчетыССотрудниками.Организация
			|	КОНЕЦ КАК Организация,
			|	ВзаиморасчетыССотрудниками.Сотрудник КАК Сотрудник,
			|	ВЫРАЗИТЬ(ВзаиморасчетыССотрудниками.Сотрудник КАК Справочник.Сотрудники).ГоловнойСотрудник КАК ГоловнойСотрудник,
			|	КадровыеДанныеГоловныхСотрудников.Фамилия КАК Фамилия,
			|	КадровыеДанныеГоловныхСотрудников.Имя КАК Имя,
			|	КадровыеДанныеГоловныхСотрудников.Отчество КАК Отчество,
			|	КадровыеДанныеГоловныхСотрудников.Должность КАК ДолжностьГоловногоСотрудникаНаКонецПериода,
			|	КадровыеДанныеГоловныхСотрудников.РазрядКатегория КАК РазрядКатегорияГоловногоСотрудникаНаКонецПериода,
			|	КадровыеДанныеГоловныхСотрудников.Организация КАК ОрганизацияГоловногоСотрудникаНаКонецПериода,
			|	КадровыеДанныеГоловныхСотрудников.Подразделение КАК ПодразделениеГоловногоСотрудникаНаКонецПериода,
			|	КадровыеДанныеГоловныхСотрудников.ВидЗанятости КАК ВидЗанятостиГоловногоСотрудникаНаКонецПериода,
			|	НАЧАЛОПЕРИОДА(ВзаиморасчетыССотрудниками.Период, МЕСЯЦ) КАК ПериодДействия,
			|	ВзаиморасчетыССотрудниками.Регистратор КАК Регистратор,
			|	КадровыеДанныеСотрудников.Подразделение КАК ПодразделениеНаКонецПериода,
			|	КадровыеДанныеСотрудников.ВидЗанятости КАК ВидЗанятостиНаКонецПериода,
			|	КадровыеДанныеСотрудников.Должность КАК ДолжностьНаКонецПериода,
			|	КадровыеДанныеСотрудников.РазрядКатегория КАК РазрядКатегорияНаКонецПериода,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеСотрудников.ДатаУвольнения <> ДАТАВРЕМЯ(1, 1, 1)
			|				И КадровыеДанныеСотрудников.ДатаУвольнения <= КадровыеДанныеСотрудников.Период
			|			ТОГДА КадровыеДанныеСотрудников.ТекущаяТарифнаяСтавка
			|		ИНАЧЕ КадровыеДанныеСотрудников.ТарифнаяСтавка
			|	КОНЕЦ КАК ТарифнаяСтавкаНаКонецПериода,
			|	КадровыеДанныеСотрудников.ВидЗанятости КАК ВидЗанятости,
			|	КадровыеДанныеСотрудников.Должность КАК Должность,
			|	КадровыеДанныеСотрудников.РазрядКатегория КАК РазрядКатегория,
			|	КадровыеДанныеСотрудников.ТарифнаяСтавка КАК ТарифнаяСтавка,
			|	КадровыеДанныеГоловныхСотрудников.ДатаУвольнения КАК ДатаУвольнения
			|ПОМЕСТИТЬ ВТДвиженияВзаиморасчетов
			|ИЗ
			|	РегистрНакопления.ВзаиморасчетыССотрудниками КАК ВзаиморасчетыССотрудниками
			|		{ЛЕВОЕ СОЕДИНЕНИЕ Представления_КадровыеДанныеСотрудников КАК КадровыеДанныеСотрудников
			|		ПО ВзаиморасчетыССотрудниками.Сотрудник = КадровыеДанныеСотрудников.Сотрудник
			|			И (КОНЕЦПЕРИОДА(ВзаиморасчетыССотрудниками.Период, МЕСЯЦ) = КадровыеДанныеСотрудников.Период)}
			|		{ЛЕВОЕ СОЕДИНЕНИЕ Представления_КадровыеДанныеСотрудников КАК КадровыеДанныеГоловныхСотрудников
			|		ПО (ВЫРАЗИТЬ(ВзаиморасчетыССотрудниками.Сотрудник КАК Справочник.Сотрудники).ГоловнойСотрудник = КадровыеДанныеГоловныхСотрудников.Сотрудник)
			|			И (КОНЕЦПЕРИОДА(ВзаиморасчетыССотрудниками.Период, МЕСЯЦ) = КадровыеДанныеГоловныхСотрудников.Период)}
			|ГДЕ
			|	ВзаиморасчетыССотрудниками.Период МЕЖДУ &НачалоПериода И &КонецПериода
			|	И ВзаиморасчетыССотрудниками.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
			|	И ВзаиморасчетыССотрудниками.ВидВзаиморасчетов = ЗНАЧЕНИЕ(Перечисление.ВидыВзаиморасчетовССотрудниками.ВыплатаАванса)
			|{ГДЕ
			|	ВзаиморасчетыССотрудниками.Сотрудник.*,
			|	ВзаиморасчетыССотрудниками.ФизическоеЛицо.*,
			|	ВзаиморасчетыССотрудниками.Организация.*,
			|	ВзаиморасчетыССотрудниками.Сотрудник.ГоловнойСотрудник.* КАК ГоловнойСотрудник}
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	ДанныеСотрудников.МесяцНачисления КАК МесяцНачисления,
			|	ДанныеСотрудников.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДанныеСотрудников.СтатьяФинансирования КАК СтатьяФинансирования,
			|	ДанныеСотрудников.СтатьяРасходов КАК СтатьяРасходов,
			|	ДанныеСотрудников.Подразделение КАК Подразделение,
			|	ДанныеСотрудников.Группа КАК Группа,
			|	ДанныеСотрудников.ВидРасчета КАК ВидРасчета,
			|	ДанныеСотрудников.Сумма КАК Сумма,
			|	ДанныеСотрудников.ДатаНачала КАК ДатаНачала,
			|	ДанныеСотрудников.ДатаОкончания КАК ДатаОкончания,
			|	ЕСТЬNULL(ОтработанноеВремя.ОтработаноДней, 0) КАК ОтработаноДней,
			|	ЕСТЬNULL(ОтработанноеВремя.ОтработаноЧасов, 0) КАК ОтработаноЧасов,
			|	ЕСТЬNULL(ОтработанноеВремя.ОплаченоДней, 0) КАК ОплаченоДней,
			|	ЕСТЬNULL(ОтработанноеВремя.ОплаченоЧасов, 0) КАК ОплаченоЧасов,
			|	ДанныеСотрудников.Организация КАК Организация,
			|	ДанныеСотрудников.Сотрудник КАК Сотрудник,
			|	ДанныеСотрудников.Фамилия КАК Фамилия,
			|	ДанныеСотрудников.Имя КАК Имя,
			|	ДанныеСотрудников.Отчество КАК Отчество,
			|	ДанныеСотрудников.ГоловнойСотрудник КАК ГоловнойСотрудник,
			|	ДанныеСотрудников.ДолжностьГоловногоСотрудникаНаКонецПериода КАК ДолжностьГоловногоСотрудникаНаКонецПериода,
			|	ДанныеСотрудников.РазрядКатегорияГоловногоСотрудникаНаКонецПериода КАК РазрядКатегорияГоловногоСотрудникаНаКонецПериода,
			|	ДанныеСотрудников.ОрганизацияГоловногоСотрудникаНаКонецПериода КАК ОрганизацияГоловногоСотрудникаНаКонецПериода,
			|	ДанныеСотрудников.ПодразделениеГоловногоСотрудникаНаКонецПериода КАК ПодразделениеГоловногоСотрудникаНаКонецПериода,
			|	ДанныеСотрудников.ВидЗанятостиГоловногоСотрудникаНаКонецПериода КАК ВидЗанятостиГоловногоСотрудникаНаКонецПериода,
			|	ДанныеСотрудников.ПериодДействия КАК ПериодДействия,
			|	ДанныеСотрудников.Регистратор КАК Регистратор,
			|	ДанныеСотрудников.ПодразделениеНаКонецПериода КАК ПодразделениеНаКонецПериода,
			|	ДанныеСотрудников.ВидЗанятостиНаКонецПериода КАК ВидЗанятостиНаКонецПериода,
			|	ДанныеСотрудников.ДолжностьНаКонецПериода КАК ДолжностьНаКонецПериода,
			|	ДанныеСотрудников.РазрядКатегорияНаКонецПериода КАК РазрядКатегорияНаКонецПериода,
			|	ДанныеСотрудников.ТарифнаяСтавкаНаКонецПериода КАК ТарифнаяСтавкаНаКонецПериода,
			|	ДанныеСотрудников.ВидЗанятости КАК ВидЗанятости,
			|	ДанныеСотрудников.Должность КАК Должность,
			|	ДанныеСотрудников.РазрядКатегория КАК РазрядКатегория,
			|	ДанныеСотрудников.ТарифнаяСтавка КАК ТарифнаяСтавка,
			|	ОтработанноеВремя.ВремяВЧасах КАК ВремяВЧасах,
			|	ДанныеСотрудников.Показатель КАК Показатель,
			|	ДанныеСотрудников.Значение КАК Значение,
			|	ДанныеСотрудников.ДатаУвольнения КАК ДатаУвольнения,
			|	ДанныеСотрудников.Сторно КАК Сторно
			|ПОМЕСТИТЬ ОбщиеЗапросы_НачисленияУдержанияАвансом
			|ИЗ
			|	ВТНачисленияИУдержанияСКадровымиДанными КАК ДанныеСотрудников
			|		{ЛЕВОЕ СОЕДИНЕНИЕ ВТОтработанноеВремя КАК ОтработанноеВремя
			|		ПО ДанныеСотрудников.Регистратор = ОтработанноеВремя.Регистратор
			|			И ДанныеСотрудников.Сотрудник = ОтработанноеВремя.Сотрудник
			|			И ДанныеСотрудников.Подразделение = ОтработанноеВремя.Подразделение
			|			И ДанныеСотрудников.ВидРасчета = ОтработанноеВремя.ВидРасчета
			|			И ДанныеСотрудников.МесяцНачисления = ОтработанноеВремя.МесяцНачисления
			|			И ДанныеСотрудников.ДатаНачала = ОтработанноеВремя.ДатаНачала
			|			И ДанныеСотрудников.СтатьяФинансирования = ОтработанноеВремя.СтатьяФинансирования
			|			И ДанныеСотрудников.СтатьяРасходов = ОтработанноеВремя.СтатьяРасходов
			|			И ДанныеСотрудников.ИдентификаторСтроки = ОтработанноеВремя.ИдентификаторСтроки}
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ДанныеСотрудников.МесяцНачисления,
			|	ДанныеСотрудников.ФизическоеЛицо,
			|	ДанныеСотрудников.СтатьяФинансирования,
			|	ДанныеСотрудников.СтатьяРасходов,
			|	ДанныеСотрудников.Подразделение,
			|	ДанныеСотрудников.Группа,
			|	ДанныеСотрудников.ВидРасчета,
			|	ДанныеСотрудников.Сумма,
			|	NULL,
			|	NULL,
			|	NULL,
			|	NULL,
			|	NULL,
			|	NULL,
			|	ДанныеСотрудников.Организация,
			|	ДанныеСотрудников.Сотрудник,
			|	ДанныеСотрудников.Фамилия,
			|	ДанныеСотрудников.Имя,
			|	ДанныеСотрудников.Отчество,
			|	ДанныеСотрудников.ГоловнойСотрудник,
			|	ДанныеСотрудников.ДолжностьГоловногоСотрудникаНаКонецПериода,
			|	ДанныеСотрудников.РазрядКатегорияГоловногоСотрудникаНаКонецПериода,
			|	ДанныеСотрудников.ОрганизацияГоловногоСотрудникаНаКонецПериода,
			|	ДанныеСотрудников.ПодразделениеГоловногоСотрудникаНаКонецПериода,
			|	ДанныеСотрудников.ВидЗанятостиГоловногоСотрудникаНаКонецПериода,
			|	ДанныеСотрудников.ПериодДействия,
			|	ДанныеСотрудников.Регистратор,
			|	ДанныеСотрудников.ПодразделениеНаКонецПериода,
			|	ДанныеСотрудников.ВидЗанятостиНаКонецПериода,
			|	ДанныеСотрудников.ДолжностьНаКонецПериода,
			|	ДанныеСотрудников.РазрядКатегорияНаКонецПериода,
			|	ДанныеСотрудников.ТарифнаяСтавкаНаКонецПериода,
			|	ДанныеСотрудников.ВидЗанятости,
			|	ДанныеСотрудников.Должность,
			|	ДанныеСотрудников.РазрядКатегория,
			|	ДанныеСотрудников.ТарифнаяСтавка,
			|	NULL,
			|	NULL,
			|	NULL,
			|	ДанныеСотрудников.ДатаУвольнения,
			|	NULL
			|ИЗ
			|	ВТДвиженияВзаиморасчетов КАК ДанныеСотрудников
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ДанныеСотрудников.Период,
			|	ДанныеСотрудников.ФизическоеЛицо,
			|	ДанныеСотрудников.СтатьяФинансирования,
			|	ДанныеСотрудников.СтатьяРасходов,
			|	ДанныеСотрудников.Подразделение,
			|	ЗНАЧЕНИЕ(Перечисление.ГруппыНачисленияУдержанияВыплаты.НачальноеСальдо),
			|	NULL,
			|	ДанныеСотрудников.НачальныйОстаток,
			|	NULL,
			|	NULL,
			|	NULL,
			|	NULL,
			|	NULL,
			|	NULL,
			|	ДанныеСотрудников.Организация,
			|	ДанныеСотрудников.Сотрудник,
			|	ДанныеСотрудников.Фамилия,
			|	ДанныеСотрудников.Имя,
			|	ДанныеСотрудников.Отчество,
			|	ДанныеСотрудников.ГоловнойСотрудник,
			|	ДанныеСотрудников.ДолжностьГоловногоСотрудникаНаКонецПериода,
			|	ДанныеСотрудников.РазрядКатегорияГоловногоСотрудникаНаКонецПериода,
			|	ДанныеСотрудников.ОрганизацияГоловногоСотрудникаНаКонецПериода,
			|	ДанныеСотрудников.ПодразделениеГоловногоСотрудникаНаКонецПериода,
			|	ДанныеСотрудников.ВидЗанятостиГоловногоСотрудникаНаКонецПериода,
			|	NULL,
			|	NULL,
			|	ДанныеСотрудников.ПодразделениеНаКонецПериода,
			|	ДанныеСотрудников.ВидЗанятостиНаКонецПериода,
			|	ДанныеСотрудников.ДолжностьНаКонецПериода,
			|	ДанныеСотрудников.РазрядКатегорияНаКонецПериода,
			|	ДанныеСотрудников.ТарифнаяСтавка,
			|	ДанныеСотрудников.ВидЗанятости,
			|	ДанныеСотрудников.Должность,
			|	ДанныеСотрудников.РазрядКатегория,
			|	ДанныеСотрудников.ТарифнаяСтавка,
			|	NULL,
			|	NULL,
			|	NULL,
			|	ДанныеСотрудников.ДатаУвольнения,
			|	NULL
			|ИЗ
			|	ВТСальдоПоРасчетамССотрудниками КАК ДанныеСотрудников
			|ГДЕ
			|	ДанныеСотрудников.Организация ЕСТЬ НЕ NULL ";
		
	КонецЕсли;
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ПолучитьЗапросПоПредставлению(ТекстЗапроса, СоответствиеПараметров) Экспорт
	
	Запрос = Неопределено;
	
	ПозицияСловаПоместить = СтрНайти(ВРег(ТекстЗапроса), "ПОМЕСТИТЬ ");
	
	ИмяИсточникаДанных = ЗарплатаКадрыОбщиеНаборыДанных.ПервоеСловоНачинаяСПозицииВТексте(ТекстЗапроса, ПозицияСловаПоместить + СтрДлина("ПОМЕСТИТЬ "));
	МассивПодстрокИмениИсточникаДанных = СтроковыеФункцииКлиентСервер.РазложитьСтрокуВМассивПодстрок(ИмяИсточникаДанных, "_");
	ИмяВременнойТаблицы = МассивПодстрокИмениИсточникаДанных[0];
	ИмяПредставления = МассивПодстрокИмениИсточникаДанных[1];
	Если МассивПодстрокИмениИсточникаДанных.Количество() > 2 Тогда
		ИмяПараметра = МассивПодстрокИмениИсточникаДанных[2];
	Иначе
		ИмяПараметра = Неопределено;
	КонецЕсли;
	
	МассивИменВТИсточниковПараметров = ЗарплатаКадрыОбщиеНаборыДанных.МассивИменВТИсточниковПараметров(ТекстЗапроса, ИмяИсточникаДанных);
	ПараметрыЗапроса = ЗарплатаКадрыОбщиеНаборыДанных.ПараметрыЗапроса(ТекстЗапроса, ИмяИсточникаДанных);
	
	ПредставлениеТолькоРазрешенные = ЗарплатаКадрыОбщиеНаборыДанных.ПараметрЗапроса("ТолькоРазрешенные", ПараметрыЗапроса);
	ТолькоРазрешенные = ВРег(ПредставлениеТолькоРазрешенные) = "ИСТИНА";
	
	Если ВРег(ИмяПредставления) = ВРег("ШтатноеРасписание") Тогда
		
		ПредставлениеВключатьНачисления = ЗарплатаКадрыОбщиеНаборыДанных.ПараметрЗапроса("ВключатьНачисления", ПараметрыЗапроса);
		НеВключатьНачисления = ВРег(ПредставлениеВключатьНачисления) = "ЛОЖЬ";
		
		ДатаАктуальности = ЗарплатаКадрыОбщиеНаборыДанных.ПараметрЗапроса("ДатаАктуальности", ПараметрыЗапроса);
		Если МассивИменВТИсточниковПараметров.Количество() > 0  Тогда
			ИмяВТИсточникДанных = МассивИменВТИсточниковПараметров[0];
		Иначе
			ИмяВТИсточникДанных = "";
		КонецЕсли;
		
		КоллекцияПолей = ЗарплатаКадрыОбщиеНаборыДанных.МассивПолейЗапроса(Лев(ТекстЗапроса, ПозицияСловаПоместить - 1));
		Запрос = УправлениеШтатнымРасписанием.ЗапросПредставленияШтатноеРасписание(ТолькоРазрешенные, ДатаАктуальности, КоллекцияПолей, ИмяИсточникаДанных, НЕ НеВключатьНачисления, ИмяВТИсточникДанных);
		
	ИначеЕсли ВРег(ИмяПредставления) = ВРег("ТекущаяКадроваяРасстановка") Тогда
		
		Организация = ЗарплатаКадрыОбщиеНаборыДанных.ПараметрЗапроса("Организация", ПараметрыЗапроса);
		Дата = ЗарплатаКадрыОбщиеНаборыДанных.ПараметрЗапроса("Дата", ПараметрыЗапроса);
		
		Запрос = КадровыйУчетРасширенный.ЗапросВТТекущаяКадроваяРасстановка(
			ТолькоРазрешенные,
			Организация,
			Дата,
			ИмяИсточникаДанных);
			
	ИначеЕсли ВРег(ИмяПредставления) = ВРЕг("ФункциональныеОпцииОрганизаций") Тогда
			
		МассивИменФункциональныхОпций =  ЗарплатаКадрыОбщиеНаборыДанных.МассивПолейЗапроса(Лев(ТекстЗапроса, ПозицияСловаПоместить - 1));
		
		Запрос = КадровыйУчетБазовый.ЗапросВТФункциональныеОпцииОрганизаций(
			ТолькоРазрешенные,
			ИмяИсточникаДанных,
			МассивИменФункциональныхОпций);
				
	ИначеЕсли ВРег(ИмяПредставления) = ВРег("ФактическиеОтпускаСотрудников") Тогда
			
		ИмяВТИсточникДанных = МассивИменВТИсточниковПараметров[0];
		
		ОписательВременныхТаблиц = ОстаткиОтпусков.ОписательВременныхТаблицДляСоздатьВТФактическиеОтпускаСотрудников(
			Неопределено,
			ИмяВТИсточникДанных,
			,
			ИмяИсточникаДанных);
		
		Запрос = ОстаткиОтпусков.ЗапросВТФактическиеОтпускаСотрудников(ОписательВременныхТаблиц, ТолькоРазрешенные);
		
	ИначеЕсли ВРег(ИмяПредставления) = ВРег("ПлановыеНачисленияСотрудников") Тогда
		
		ИмяВТИсточникДанных = МассивИменВТИсточниковПараметров[0];
		Запрос = КадровыйУчетРасширенный.ЗапросВТПлановыеНачисленияСотрудников(ТолькоРазрешенные, ИмяИсточникаДанных, ИмяВТИсточникДанных);
		
	ИначеЕсли ВРег(ИмяПредставления) = ВРег("ПлановыеУдержанияСотрудников") Тогда
		
		ИмяВТИсточникДанных = МассивИменВТИсточниковПараметров[0];
		Запрос = КадровыйУчетРасширенный.ЗапросВТПлановыеУдержанияСотрудников(ТолькоРазрешенные, ИмяИсточникаДанных, ИмяВТИсточникДанных);
		
	ИначеЕсли ВРег(ИмяПредставления) = ВРег("СтажиСотрудников") Тогда
		
		ИмяВТИсточникДанных = МассивИменВТИсточниковПараметров[0];
		ОписаниеВременнойТаблицыОтборов = КадровыйУчетРасширенный.ОписательВременнойТаблицыОтборовДляВТСтажиФизическихЛиц(ИмяВТИсточникДанных);
		Запрос = КадровыйУчетРасширенный.ЗапросВТСтажиФизическихЛиц(ТолькоРазрешенные, ОписаниеВременнойТаблицыОтборов, ИмяИсточникаДанных);
		
	ИначеЕсли ВРег(ИмяПредставления) = ВРег("СвойстваСтатейФинансирования") Тогда
		
		Если ПолучитьФункциональнуюОпцию("РаботаВХозрасчетнойОрганизации") Тогда
			
			Запрос = Новый Запрос;
			
			Запрос.Текст =
				"ВЫБРАТЬ РАЗРЕШЕННЫЕ
				|	СтатьиФинансированияЗарплата.Ссылка КАК СтатьяФинансирования,
				|	2 КАК НомерКолонки
				|ПОМЕСТИТЬ Представления_СвойстваСтатейФинансирования
				|ИЗ
				|	Справочник.СтатьиФинансированияЗарплата КАК СтатьиФинансированияЗарплата";
			
		КонецЕсли;
		
	КонецЕсли;
	
	Если Запрос = Неопределено Тогда
		Запрос = УчетРабочегоВремениРасширенный.ЗапросПоПредставлению(ТолькоРазрешенные, ИмяПредставления, МассивИменВТИсточниковПараметров, ПараметрыЗапроса, ИмяИсточникаДанных);
	КонецЕсли;	
	
	Если Запрос = Неопределено Тогда
		Если ОбщегоНазначения.ПодсистемаСуществует("ЗарплатаКадрыПриложения.ОрганизационнаяСтруктура") Тогда
			Модуль = ОбщегоНазначения.ОбщийМодуль("ОрганизационнаяСтруктура");
			Запрос = Модуль.ЗапросПоПредставлению(ИмяПредставления, МассивИменВТИсточниковПараметров, ТолькоРазрешенные);
		КонецЕсли;
	КонецЕсли;
	
	Если Запрос = Неопределено Тогда
		Если ОбщегоНазначения.ПодсистемаСуществует("ЗарплатаКадрыПриложения.АттестацииСотрудников") Тогда
			Модуль = ОбщегоНазначения.ОбщийМодуль("АттестацииСотрудников");
			Запрос = Модуль.ЗапросПоПредставлению(ИмяПредставления, ПараметрыЗапроса);
		КонецЕсли;
	КонецЕсли;
	
	Если Запрос = Неопределено Тогда
		Если ОбщегоНазначения.ПодсистемаСуществует("ЗарплатаКадрыПриложения.Медицина") Тогда
			Модуль = ОбщегоНазначения.ОбщийМодуль("Медицина");
			Запрос = Модуль.ЗапросПоПредставлению(ИмяПредставления, ПараметрыЗапроса);
		КонецЕсли;
	КонецЕсли;
	
	Если Запрос = Неопределено Тогда
		Если ОбщегоНазначения.ПодсистемаСуществует("ЗарплатаКадрыПриложения.УчетБюджетныхУчреждений") Тогда
			МодульУчетБюджетныхУчреждений = ОбщегоНазначения.ОбщийМодуль("УчетБюджетныхУчреждений");
			Запрос = МодульУчетБюджетныхУчреждений.ЗапросПоПредставлению(ИмяПредставления, ПараметрыЗапроса);
		КонецЕсли;
	КонецЕсли;
	
	Если Запрос = Неопределено Тогда
		Запрос = ЗарплатаКадрыОбщиеНаборыДанныхБазовый.ПолучитьЗапросПоПредставлению(ТекстЗапроса, СоответствиеПараметров);
	КонецЕсли;
		
	Возврат Запрос;
	
КонецФункции

Процедура ПриПолученииСвойствРегистра(ИмяРегистра, СтруктураОписанияРегистра) Экспорт
	ПлановыеНачисленияСотрудников.ПриПолученииСвойствРегистраВторичныхДанных(ИмяРегистра, СтруктураОписанияРегистра);	
КонецПроцедуры

Функция ЗапросВТПредставленияОтработанноеВремя(ИмяВТНачисленияИУдержания, НачалоПериода, ОкончаниеПериода, ИмяВТОтработанноеВремя) Экспорт
	
	Запрос = ЗарплатаКадрыОбщиеНаборыДанныхБазовый.ЗапросВТПредставленияОтработанноеВремя(ИмяВТНачисленияИУдержания, НачалоПериода, ОкончаниеПериода, ИмяВТОтработанноеВремя);
	
	ТекстЗапросаСКорректировками =
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	НАЧАЛОПЕРИОДА(ОтработанноеВремя.Период, МЕСЯЦ) КАК МесяцНачисления,
		|	ОтработанноеВремя.ПериодДействия КАК ПериодДействия,
		|	ОтработанноеВремя.Регистратор КАК Регистратор,
		|	ОтработанноеВремя.Сотрудник КАК Сотрудник,
		|	ОтработанноеВремя.Организация КАК Организация,
		|	ОтработанноеВремя.Подразделение КАК Подразделение,
		|	ОтработанноеВремя.Начисление КАК ВидРасчета,
		|	ОтработанноеВремя.ДокументОснование КАК ДокументОснование,
		|	ОтработанноеВремя.ДатаНачала КАК ДатаНачала,
		|	ОтработанноеВремя.ВремяВЧасах КАК ВремяВЧасах,
		|	ОтработанноеВремя.ИдентификаторСтроки КАК ИдентификаторСтроки,
		|	ОтработанноеВремя.ОтработаноДней КАК ОтработаноДней,
		|	ОтработанноеВремя.ОтработаноЧасов КАК ОтработаноЧасов,
		|	ВЫБОР
		|		КОГДА ОтработанноеВремя.Период = ОтработанноеВремя.ПериодДействия
		|			ТОГДА ОтработанноеВремя.ОтработаноДней
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК ОтработаноДнейВПериоде,
		|	ВЫБОР
		|		КОГДА ОтработанноеВремя.Период = ОтработанноеВремя.ПериодДействия
		|			ТОГДА ОтработанноеВремя.ОтработаноЧасов
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК ОтработаноЧасовВПериоде,
		|	ОтработанноеВремя.ОплаченоДней КАК ОплаченоДней,
		|	ОтработанноеВремя.ОплаченоЧасов КАК ОплаченоЧасов
		|ПОМЕСТИТЬ ВТПериодыОтработанноеВремяСКорректировками
		|ИЗ
		|	РегистрНакопления.ОтработанноеВремяПоСотрудникам КАК ОтработанноеВремя
		|ГДЕ
		|	ОтработанноеВремя.Период МЕЖДУ &ОтработанноеВремяПараметрНачалоПериода И &ОтработанноеВремяПараметрОкончаниеПериода
		|{ГДЕ
		|	ОтработанноеВремя.Сотрудник.*,
		|	ОтработанноеВремя.ФизическоеЛицо.*,
		|	ОтработанноеВремя.Организация.*,
		|	ОтработанноеВремя.Сотрудник.ГоловнойСотрудник.* КАК ГоловнойСотрудник}
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	НАЧАЛОПЕРИОДА(ОтработанноеВремя.Период, МЕСЯЦ),
		|	ОтработанноеВремя.ПериодДействия,
		|	ОтработанноеВремя.Регистратор,
		|	ОтработанноеВремя.Сотрудник,
		|	ОтработанноеВремя.Организация,
		|	ОтработанноеВремя.Подразделение,
		|	ОтработанноеВремя.Начисление,
		|	ОтработанноеВремя.ДокументОснование,
		|	ОтработанноеВремя.ДатаНачала,
		|	ЛОЖЬ,
		|	ОтработанноеВремя.ИдентификаторСтроки,
		|	ОтработанноеВремя.ОтработаноДней,
		|	NULL,
		|	ВЫБОР
		|		КОГДА ОтработанноеВремя.Период = ОтработанноеВремя.ПериодДействия
		|			ТОГДА ОтработанноеВремя.ОтработаноДней
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	NULL,
		|	ОтработанноеВремя.ОплаченоДней,
		|	NULL
		|ИЗ
		|	РегистрНакопления.ОтработанноеВремяПоСотрудникамКорректировка КАК ОтработанноеВремя
		|ГДЕ
		|	ОтработанноеВремя.Период МЕЖДУ &ОтработанноеВремяПараметрНачалоПериода И &ОтработанноеВремяПараметрОкончаниеПериода
		|{ГДЕ
		|	ОтработанноеВремя.Сотрудник.*,
		|	ОтработанноеВремя.ФизическоеЛицо.*,
		|	ОтработанноеВремя.Организация.*,
		|	ОтработанноеВремя.Сотрудник.ГоловнойСотрудник.* КАК ГоловнойСотрудник}
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	НАЧАЛОПЕРИОДА(ОтработанноеВремя.ПериодДействия, МЕСЯЦ),
		|	ОтработанноеВремя.ПериодДействия,
		|	ОтработанноеВремя.Регистратор,
		|	ОтработанноеВремя.Сотрудник,
		|	ОтработанноеВремя.Организация,
		|	ОтработанноеВремя.Подразделение,
		|	ОтработанноеВремя.Начисление,
		|	ОтработанноеВремя.ДокументОснование,
		|	ОтработанноеВремя.ДатаНачала,
		|	ОтработанноеВремя.ВремяВЧасах,
		|	ОтработанноеВремя.ИдентификаторСтроки,
		|	0,
		|	0,
		|	ОтработанноеВремя.ОтработаноДней,
		|	ОтработанноеВремя.ОтработаноЧасов,
		|	0,
		|	0
		|ИЗ
		|	РегистрНакопления.ОтработанноеВремяПоСотрудникам КАК ОтработанноеВремя
		|ГДЕ
		|	ОтработанноеВремя.ПериодДействия МЕЖДУ &ОтработанноеВремяПараметрНачалоПериода И &ОтработанноеВремяПараметрОкончаниеПериода
		|	И ОтработанноеВремя.Период <> ОтработанноеВремя.ПериодДействия
		|{ГДЕ
		|	ОтработанноеВремя.Сотрудник.*,
		|	ОтработанноеВремя.ФизическоеЛицо.*,
		|	ОтработанноеВремя.Организация.*,
		|	ОтработанноеВремя.Сотрудник.ГоловнойСотрудник.* КАК ГоловнойСотрудник}
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	НАЧАЛОПЕРИОДА(ОтработанноеВремя.ПериодДействия, МЕСЯЦ),
		|	ОтработанноеВремя.ПериодДействия,
		|	ОтработанноеВремя.Регистратор,
		|	ОтработанноеВремя.Сотрудник,
		|	ОтработанноеВремя.Организация,
		|	ОтработанноеВремя.Подразделение,
		|	ОтработанноеВремя.Начисление,
		|	ОтработанноеВремя.ДокументОснование,
		|	ОтработанноеВремя.ДатаНачала,
		|	ЛОЖЬ,
		|	ОтработанноеВремя.ИдентификаторСтроки,
		|	0,
		|	0,
		|	ОтработанноеВремя.ОтработаноДней,
		|	0,
		|	0,
		|	0
		|ИЗ
		|	РегистрНакопления.ОтработанноеВремяПоСотрудникамКорректировка КАК ОтработанноеВремя
		|ГДЕ
		|	ОтработанноеВремя.ПериодДействия МЕЖДУ &ОтработанноеВремяПараметрНачалоПериода И &ОтработанноеВремяПараметрОкончаниеПериода
		|	И ОтработанноеВремя.Период <> ОтработанноеВремя.ПериодДействия
		|{ГДЕ
		|	ОтработанноеВремя.Сотрудник.*,
		|	ОтработанноеВремя.ФизическоеЛицо.*,
		|	ОтработанноеВремя.Организация.*,
		|	ОтработанноеВремя.Сотрудник.ГоловнойСотрудник.* КАК ГоловнойСотрудник}
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ОтработанноеВремяВПериодахСКорректировками.МесяцНачисления КАК МесяцНачисления,
		|	ОтработанноеВремяВПериодахСКорректировками.ПериодДействия КАК ПериодДействия,
		|	ОтработанноеВремяВПериодахСКорректировками.Регистратор КАК Регистратор,
		|	ОтработанноеВремяВПериодахСКорректировками.Сотрудник КАК Сотрудник,
		|	ОтработанноеВремяВПериодахСКорректировками.Организация КАК Организация,
		|	ОтработанноеВремяВПериодахСКорректировками.Подразделение КАК Подразделение,
		|	ОтработанноеВремяВПериодахСКорректировками.ВидРасчета КАК ВидРасчета,
		|	ОтработанноеВремяВПериодахСКорректировками.ДокументОснование КАК ДокументОснование,
		|	ОтработанноеВремяВПериодахСКорректировками.ДатаНачала КАК ДатаНачала,
		|	ОтработанноеВремяВПериодахСКорректировками.ВремяВЧасах КАК ВремяВЧасах,
		|	ОтработанноеВремяВПериодахСКорректировками.ИдентификаторСтроки КАК ИдентификаторСтроки,
		|	СУММА(ОтработанноеВремяВПериодахСКорректировками.ОтработаноДней) КАК ОтработаноДней,
		|	СУММА(ОтработанноеВремяВПериодахСКорректировками.ОтработаноЧасов) КАК ОтработаноЧасов,
		|	СУММА(ОтработанноеВремяВПериодахСКорректировками.ОтработаноДнейВПериоде) КАК ОтработаноДнейВПериоде,
		|	СУММА(ОтработанноеВремяВПериодахСКорректировками.ОтработаноЧасовВПериоде) КАК ОтработаноЧасовВПериоде,
		|	СУММА(ОтработанноеВремяВПериодахСКорректировками.ОплаченоДней) КАК ОплаченоДней,
		|	СУММА(ОтработанноеВремяВПериодахСКорректировками.ОплаченоЧасов) КАК ОплаченоЧасов
		|ПОМЕСТИТЬ ВТПериодыОтработанноеВремя
		|ИЗ
		|	ВТПериодыОтработанноеВремяСКорректировками КАК ОтработанноеВремяВПериодахСКорректировками
		|
		|СГРУППИРОВАТЬ ПО
		|	ОтработанноеВремяВПериодахСКорректировками.МесяцНачисления,
		|	ОтработанноеВремяВПериодахСКорректировками.ПериодДействия,
		|	ОтработанноеВремяВПериодахСКорректировками.Регистратор,
		|	ОтработанноеВремяВПериодахСКорректировками.Сотрудник,
		|	ОтработанноеВремяВПериодахСКорректировками.Подразделение,
		|	ОтработанноеВремяВПериодахСКорректировками.ВидРасчета,
		|	ОтработанноеВремяВПериодахСКорректировками.ДокументОснование,
		|	ОтработанноеВремяВПериодахСКорректировками.ДатаНачала,
		|	ОтработанноеВремяВПериодахСКорректировками.ВремяВЧасах,
		|	ОтработанноеВремяВПериодахСКорректировками.ИдентификаторСтроки,
		|	ОтработанноеВремяВПериодахСКорректировками.Организация
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|УНИЧТОЖИТЬ ВТПериодыОтработанноеВремяСКорректировками";
	
	Если ТипЗнч(НачалоПериода) = Тип("Строка") Тогда
		ТекстЗапросаСКорректировками = СтрЗаменить(ТекстЗапросаСКорректировками, "&ОтработанноеВремяПараметрНачалоПериода", НачалоПериода);
	КонецЕсли;
	
	Если ТипЗнч(ОкончаниеПериода) = Тип("Строка") Тогда
		ТекстЗапросаСКорректировками = СтрЗаменить(ТекстЗапросаСКорректировками, "&ОтработанноеВремяПараметрОкончаниеПериода", ОкончаниеПериода);
	КонецЕсли;
	
	Если Не ЗарплатаКадрыОбщиеНаборыДанных.ЗаменитьЗапросСозданияВременнойТаблицы(Запрос.Текст, "ВТПериодыОтработанноеВремя", ТекстЗапросаСКорректировками) Тогда
		ВызватьИсключение НСтр("ru='Неправильный текст запроса к отработанному времени'");
	КонецЕсли;
	
	Возврат Запрос;
	
КонецФункции

Функция ЗапросПредставленияКадровыеДанныеСотрудниковАнализНачисленийИУдержаний(ТекстИсходногоЗапроса) Экспорт
	
	Запрос = ЗарплатаКадрыОбщиеНаборыДанныхБазовый.ЗапросПредставленияКадровыеДанныеСотрудниковАнализНачисленийИУдержаний(ТекстИсходногоЗапроса);
	Возврат Запрос;
	
КонецФункции


#Область КонтекстноеДополнениеСхемКомпоновки

Процедура ДополнитьАнализЗадолженностиПоЗарплате(ЭтотОбъект) Экспорт
	
	Если ОбщегоНазначения.ДоступноИспользованиеРазделенныхДанных() Тогда
		Если ОбщегоНазначения.ПодсистемаСуществует("ЗарплатаКадрыПриложения.УчетБюджетныхУчреждений") Тогда
			ОбщегоНазначения.ОбщийМодуль("УчетБюджетныхУчреждений").ДополнитьАнализЗадолженностиПоЗарплате(ЭтотОбъект);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

Процедура ДополнитьШтатноеРасписание(ЭтотОбъект) Экспорт
	
	Если ОбщегоНазначения.ДоступноИспользованиеРазделенныхДанных() Тогда
		Если ОбщегоНазначения.ПодсистемаСуществует("ЗарплатаКадрыПриложения.УчетБюджетныхУчреждений") Тогда
			ОбщегоНазначения.ОбщийМодуль("УчетБюджетныхУчреждений").ДополнитьШтатноеРасписание(ЭтотОбъект);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

Процедура ДополнитьШтатноеРасписаниеНачисления(ЭтотОбъект) Экспорт
	
	Если ОбщегоНазначения.ДоступноИспользованиеРазделенныхДанных() Тогда
		Если ОбщегоНазначения.ПодсистемаСуществует("ЗарплатаКадрыПриложения.УчетБюджетныхУчреждений") Тогда
			ОбщегоНазначения.ОбщийМодуль("УчетБюджетныхУчреждений").ДополнитьШтатноеРасписаниеНачисления(ЭтотОбъект);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

Процедура ДополнитьТекстЗапросаНачисленияУдержанияЗначениямиПоказателей(ТекстЗапроса)
	
	МассивПодзапросов = СтрРазделить(ТекстЗапроса, ";");
	Для каждого ТекстПодзапроса Из МассивПодзапросов Цикл
		
		Если СтрНайти(ВРег(ТекстПодзапроса), ВРег("ПОМЕСТИТЬ ВТНачисленияИУдержанияСКадровымиДанными")) > 0 Тогда
			
			ИсходныйПодзапрос = ТекстПодзапроса;
			
			ТекстЗапросаПоказателейНачислений =
				"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
				|	СотрудникиМесяцы.Организация КАК Организация,
				|	СотрудникиМесяцы.Сотрудник КАК Сотрудник,
				|	СотрудникиМесяцы.Месяц КАК ПериодРегистрации,
				|	Начисления.Регистратор КАК Регистратор,
				|	Начисления.ПериодДействияНачало КАК ПериодДействияНачало,
				|	МИНИМУМ(Начисления.ПериодДействияКонец) КАК ПериодДействияКонец,
				|	Начисления.ВидРасчета КАК ВидРасчета,
				|	НачисленияПоказатели.Показатель КАК Показатель,
				|	Начисления.ИдентификаторСтроки КАК ИдентификаторСтроки
				|ПОМЕСТИТЬ ВТПоказателиНачисленийПредварительно
				|ИЗ
				|	ВТСотрудникиМесяцы КАК СотрудникиМесяцы
				|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрРасчета.Начисления КАК Начисления
				|			ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.Начисления.Показатели КАК НачисленияПоказатели
				|			ПО Начисления.ВидРасчета = НачисленияПоказатели.Ссылка
				|				И (НачисленияПоказатели.ОсновнойПоказатель)
				|		ПО СотрудникиМесяцы.Сотрудник = Начисления.Сотрудник
				|			И СотрудникиМесяцы.Месяц = Начисления.ПериодРегистрации
				|ГДЕ
				|	НЕ НачисленияПоказатели.Показатель ЕСТЬ NULL
				|
				|СГРУППИРОВАТЬ ПО
				|	СотрудникиМесяцы.Организация,
				|	СотрудникиМесяцы.Сотрудник,
				|	СотрудникиМесяцы.Месяц,
				|	Начисления.Регистратор,
				|	Начисления.ПериодДействияНачало,
				|	Начисления.ВидРасчета,
				|	Начисления.ИдентификаторСтроки,
				|	НачисленияПоказатели.Показатель
				|
				|ОБЪЕДИНИТЬ
				|
				|ВЫБРАТЬ РАЗЛИЧНЫЕ
				|	СотрудникиМесяцы.Организация,
				|	СотрудникиМесяцы.Сотрудник,
				|	СотрудникиМесяцы.Месяц,
				|	Удержания.Регистратор,
				|	Удержания.ПериодРегистрации,
				|	МИНИМУМ(Удержания.ПериодРегистрации),
				|	Удержания.ВидРасчета,
				|	УдержанияПоказатели.Показатель,
				|	Удержания.ИдентификаторСтроки
				|ИЗ
				|	ВТСотрудникиМесяцы КАК СотрудникиМесяцы
				|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрРасчета.Удержания КАК Удержания
				|			ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.Удержания.Показатели КАК УдержанияПоказатели
				|			ПО Удержания.ВидРасчета = УдержанияПоказатели.Ссылка
				|				И (УдержанияПоказатели.ОсновнойПоказатель)
				|		ПО СотрудникиМесяцы.ФизическоеЛицо = Удержания.ФизическоеЛицо
				|			И СотрудникиМесяцы.Месяц = Удержания.ПериодРегистрации
				|ГДЕ
				|	НЕ УдержанияПоказатели.Показатель ЕСТЬ NULL
				|
				|СГРУППИРОВАТЬ ПО
				|	СотрудникиМесяцы.Организация,
				|	СотрудникиМесяцы.Сотрудник,
				|	СотрудникиМесяцы.Месяц,
				|	Удержания.Регистратор,
				|	Удержания.ПериодРегистрации,
				|	Удержания.ВидРасчета,
				|	Удержания.ИдентификаторСтроки,
				|	УдержанияПоказатели.Показатель
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
				|	ПоказателиНачислений.Сотрудник КАК Сотрудник,
				|	ПоказателиНачислений.Регистратор КАК Регистратор,
				|	ПоказателиНачислений.ВидРасчета КАК ВидРасчета,
				|	ПоказателиНачислений.ИдентификаторСтроки КАК ИдентификаторСтроки,
				|	МАКСИМУМ(ЕСТЬNULL(ЗначенияПоказателейНачислений.Показатель, ЗначенияПоказателейУдержаний.Показатель)) КАК Показатель,
				|	МАКСИМУМ(ЕСТЬNULL(ЗначенияПоказателейНачислений.Значение, ЗначенияПоказателейУдержаний.Значение)) КАК Значение
				|ПОМЕСТИТЬ ВТПоказателиНачислений
				|ИЗ
				|	ВТПоказателиНачисленийПредварительно КАК ПоказателиНачислений
				|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияПоказателейНачислений КАК ЗначенияПоказателейНачислений
				|		ПО ПоказателиНачислений.Регистратор = ЗначенияПоказателейНачислений.Регистратор
				|			И ПоказателиНачислений.ИдентификаторСтроки = ЗначенияПоказателейНачислений.ИдентификаторСтроки
				|			И ПоказателиНачислений.Показатель = ЗначенияПоказателейНачислений.Показатель
				|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияПоказателейУдержаний КАК ЗначенияПоказателейУдержаний
				|		ПО ПоказателиНачислений.Регистратор = ЗначенияПоказателейУдержаний.Регистратор
				|			И ПоказателиНачислений.ИдентификаторСтроки = ЗначенияПоказателейУдержаний.ИдентификаторСтроки
				|			И ПоказателиНачислений.Показатель = ЗначенияПоказателейУдержаний.Показатель
				|
				|СГРУППИРОВАТЬ ПО
				|	ПоказателиНачислений.Сотрудник,
				|	ПоказателиНачислений.Регистратор,
				|	ПоказателиНачислений.ВидРасчета,
				|	ПоказателиНачислений.ИдентификаторСтроки";
			
			СоединениеСТаблицамиПоказателей = "
				|		{ЛЕВОЕ СОЕДИНЕНИЕ ВТПоказателиНачислений КАК ПоказателиНачислений
				|		ПО НачисленияИУдержания.Регистратор = ПоказателиНачислений.Регистратор
				|			И НачисленияИУдержания.ВидРасчета = ПоказателиНачислений.ВидРасчета
				|			И НачисленияИУдержания.Сотрудник = ПоказателиНачислений.Сотрудник
				|			И НачисленияИУдержания.ИдентификаторСтроки = ПоказателиНачислений.ИдентификаторСтроки}
				|";
			
			ТекстПодзапроса = СтрЗаменить(ТекстПодзапроса, "NULL КАК Показатель", "(ПоказателиНачислений.Показатель) КАК Показатель");
			ТекстПодзапроса = СтрЗаменить(ТекстПодзапроса, "NULL КАК Значение", "(ПоказателиНачислений.Значение) КАК Значение");
			
			ТекстПодзапроса = ТекстЗапросаПоказателейНачислений
				+ ЗарплатаКадрыОбщиеНаборыДанных.РазделительЗапросов()
				+ ТекстПодзапроса
				+ СоединениеСТаблицамиПоказателей;
			
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, ИсходныйПодзапрос, ТекстПодзапроса);
			
			Прервать;
			
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

Функция ЗапросПредставленияПодразделенияСортировкиСотрудников() Экспорт
	
	Запрос = ЗарплатаКадрыОбщиеНаборыДанныхБазовый.ЗапросПредставленияПодразделенияСортировкиСотрудников();
	
	Если ОбщегоНазначения.ПодсистемаСуществует("ЗарплатаКадрыКорпоративнаяПодсистемы.УправленческаяЗарплата") Тогда
		Модуль = ОбщегоНазначения.ОбщийМодуль("УправленческаяЗарплата");
		Модуль.ДополнитьЗапросПредставленияПодразделенияСортировкиСотрудников(Запрос);
	КонецЕсли;
	
	Возврат Запрос;
	
КонецФункции

#КонецОбласти